<!DOCTYPE html>
<html lang="es" data-lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PATAC - Artesan√≠as Mexicanas</title>
    <meta name="description" content="Compra artesan√≠as mexicanas aut√©nticas directamente de artesanos.">
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- ICONS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- LIBRARIES -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    <style>
        :root {
            --primary: #8B4513;
            --primary-dark: #5C2E0A;
            --secondary: #D4A574;
            --gold: #D4AF37;
            --gold-light: #E8C76B;
            --gold-dark: #B8942C;
            --accent: #C75B39;
            --dark: #1A1A1A;
            --white: #FFFFFF;
            --light: #F5F1EC;
            --gray: #666;
            --success: #27ae60;
            --error: #e74c3c;
            --font-primary: 'Inter', sans-serif;
            --font-display: 'Playfair Display', serif;
            --shadow-sm: 0 5px 15px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 15px 35px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 30px 60px rgba(0, 0, 0, 0.3);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-primary);
            background: linear-gradient(135deg, #f5f1ec 0%, #e8dfd5 100%);
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* LANGUAGE SWITCHER */
        .lang-switcher {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--white);
            border: 1px solid rgba(139, 69, 19, 0.2);
            border-radius: 50px;
            padding: 0.3rem;
            display: flex;
            gap: 0.3rem;
            box-shadow: var(--shadow-sm);
            z-index: 100;
        }

        .lang-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
            color: var(--gray);
        }

        .lang-btn.active {
            background: var(--primary);
            color: var(--white);
        }

        .lang-btn:hover:not(.active) {
            background: rgba(139, 69, 19, 0.1);
        }

        /* DEMO CONTAINER */
        .demo-container {
            max-width: 1400px;
            width: 100%;
            text-align: center;
        }

        .demo-title {
            font-family: var(--font-display);
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .demo-subtitle {
            color: var(--gray);
            margin-bottom: 2rem;
        }

        .open-modal-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            padding: 1.2rem 3rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .open-modal-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        /* MODAL OVERLAY */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(12px);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-overlay.fullscreen .modal-content {
            max-width: 100vw;
            max-height: 100vh;
            border-radius: 0;
        }

        .modal-content {
            background: var(--white);
            border-radius: 24px;
            max-width: 1400px;
            width: 100%;
            max-height: 95vh;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transform: scale(0.9) translateY(30px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .modal-overlay.active .modal-content {
            transform: scale(1) translateY(0);
        }

        /* MODAL HEADER */
        .modal-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 20;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: linear-gradient(to bottom, rgba(0,0,0,0.3), transparent);
        }

        .modal-actions {
            display: flex;
            gap: 0.5rem;
        }

        .modal-action-btn {
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 50%;
            background: var(--white);
            color: var(--dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
            font-size: 1.1rem;
        }

        .modal-action-btn:hover {
            background: var(--primary);
            color: var(--white);
            transform: scale(1.1);
        }

        .wishlist-btn.active {
            background: var(--error);
            color: var(--white);
        }

        .wishlist-btn.active:hover {
            background: #c0392b;
        }

        .modal-close {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: var(--white);
            color: var(--dark);
            cursor: pointer;
            font-size: 1.5rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: var(--error);
            color: var(--white);
            transform: rotate(90deg);
        }

        /* MODAL BODY */
        .modal-body {
            display: grid;
            grid-template-columns: 60% 40%;
            height: 100%;
            overflow: hidden;
        }

        /* GALLERY SECTION */
        .modal-gallery {
            background: linear-gradient(135deg, #f8f6f3 0%, #ebe7e0 100%);
            padding: 3rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-right: 1px solid rgba(139, 69, 19, 0.08);
            overflow-y: auto;
            position: relative;
        }

        .gallery-container {
            position: relative;
            overflow: hidden;
            border-radius: 20px;
            box-shadow: var(--shadow-md);
        }

        .product-swiper {
            width: 100%;
            height: 550px;
            overflow: hidden;
        }

        .swiper-slide {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--white);
            cursor: zoom-in;
        }

        .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .swiper-slide.zoom-active img {
            cursor: zoom-out;
        }

        .swiper-slide.zoom-active .zoom-lens {
            position: absolute;
            width: 150px;
            height: 150px;
            border: 2px solid var(--gold);
            border-radius: 50%;
            pointer-events: none;
            background: rgba(212, 175, 55, 0.1);
            backdrop-filter: blur(2px);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .swiper-slide.zoom-active:hover .zoom-lens {
            opacity: 1;
        }

        .gallery-thumbs {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            overflow-x: auto;
            padding: 0.5rem 0;
        }

        .gallery-thumb {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .gallery-thumb.active {
            border-color: var(--gold);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }

        .gallery-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            color: var(--white);
            padding: 1rem 1.5rem;
            border-radius: 50px;
            font-size: 1.2rem;
            pointer-events: none;
        }

        /* INFO SECTION */
        .modal-info {
            padding: 3.5rem;
            overflow-y: auto;
            background: var(--white);
            scrollbar-width: thin;
        }

        .modal-info::-webkit-scrollbar {
            width: 8px;
        }

        .modal-info::-webkit-scrollbar-track {
            background: var(--light);
        }

        .modal-info::-webkit-scrollbar-thumb {
            background: var(--gold);
            border-radius: 4px;
        }

        .product-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .meta-badge {
            padding: 0.4rem 0.8rem;
            background: rgba(139, 69, 19, 0.05);
            border-radius: 20px;
            font-size: 0.75rem;
            color: var(--gray);
        }

        .product-category {
            display: inline-block;
            padding: 0.5rem 1.2rem;
            background: rgba(139, 69, 19, 0.08);
            color: var(--primary);
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }

        .product-title {
            font-family: var(--font-display);
            font-size: 2.5rem;
            color: var(--primary);
            line-height: 1.2;
            margin-bottom: 0.5rem;
        }

        .product-price-section {
            display: flex;
            align-items: flex-end;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .product-price {
            font-family: var(--font-display);
            font-size: 3rem;
            color: var(--gold-dark);
            font-weight: 700;
        }

        .product-price-currency {
            font-size: 1.2rem;
            color: var(--gray);
            font-weight: 400;
        }

        .price-converter {
            background: rgba(212, 175, 55, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .price-converter:hover {
            background: rgba(212, 175, 55, 0.2);
        }

        .product-badges {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        .badge {
            padding: 0.7rem 1.3rem;
            border-radius: 40px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            transition: all 0.3s;
        }

        .badge:hover {
            transform: translateY(-2px);
        }

        .badge-stock {
            background: rgba(46, 204, 113, 0.12);
            color: var(--success);
            border: 1.5px solid rgba(46, 204, 113, 0.3);
        }

        .badge-impact {
            background: rgba(212, 175, 55, 0.15);
            color: var(--gold-dark);
            border: 1.5px solid rgba(212, 175, 55, 0.4);
        }

        .badge-handmade {
            background: rgba(199, 91, 57, 0.1);
            color: var(--accent);
            border: 1.5px solid rgba(199, 91, 57, 0.25);
        }

        .badge-certified {
            background: rgba(155, 89, 182, 0.1);
            color: #9b59b6;
            border: 1.5px solid rgba(155, 89, 182, 0.25);
        }

        .product-description {
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.03), rgba(212, 175, 55, 0.05));
            padding: 1.8rem;
            border-radius: 16px;
            border-left: 4px solid var(--gold);
            margin-bottom: 2rem;
        }

        .product-description h3 {
            font-family: var(--font-display);
            color: var(--primary);
            font-size: 1.4rem;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .product-description p {
            color: var(--dark);
            line-height: 1.7;
            font-size: 1rem;
        }

        /* ARTISAN CARD */
        .artisan-card {
            background: linear-gradient(135deg, #fdfbf9 0%, #f5f1ec 100%);
            padding: 2rem;
            border-radius: 20px;
            border: 2px solid rgba(139, 69, 19, 0.1);
            margin-bottom: 2rem;
            transition: all 0.3s;
        }

        .artisan-card:hover {
            border-color: var(--gold);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.15);
        }

        .artisan-card h3 {
            font-family: var(--font-display);
            color: var(--primary);
            font-size: 1.3rem;
            margin-bottom: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .artisan-profile {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .artisan-avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--white);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
        }

        .artisan-details h4 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .artisan-location {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gray);
            margin-bottom: 0.3rem;
        }

        .artisan-technique {
            color: var(--accent);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .artisan-story {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed rgba(139, 69, 19, 0.2);
            font-size: 0.9rem;
            color: var(--gray);
            line-height: 1.6;
        }

        .artisan-story.show-more {
            max-height: none;
        }

        .show-more-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            margin-top: 0.5rem;
            font-size: 0.85rem;
        }

        /* TRUST BADGES */
        .trust-section {
            background: rgba(46, 204, 113, 0.05);
            padding: 1.5rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            border: 1px solid rgba(46, 204, 113, 0.15);
        }

        .trust-badges {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
        }

        .trust-badge {
            text-align: center;
            font-size: 0.8rem;
            color: var(--gray);
        }

        .trust-icon {
            width: 40px;
            height: 40px;
            margin: 0 auto 0.5rem;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.2rem;
        }

        /* CTA BUTTONS */
        .cta-button {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: var(--white);
            width: 100%;
            padding: 1.3rem;
            border: none;
            border-radius: 50px;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .cta-button::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -60%;
            width: 20px;
            height: 200%;
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(30deg);
            transition: all 0.6s;
        }

        .cta-button:hover::after {
            left: 120%;
        }

        .cta-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .cta-button:disabled:hover {
            transform: none;
            box-shadow: var(--shadow-sm);
        }

        /* STICKY CTA (mobile) */
        .sticky-cta {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            padding: 1rem;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.15);
            display: none;
            z-index: 9998;
        }

        .sticky-cta-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .sticky-price {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--gold-dark);
            font-weight: 700;
        }

        .sticky-cta .cta-button {
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            width: auto;
        }

        .impact-note {
            text-align: center;
            margin-top: 1.2rem;
            color: var(--gray);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .impact-note strong {
            color: var(--gold-dark);
        }

        /* LIGHTBOX */
        .lightbox {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 12px;
        }

        .lightbox-close {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: var(--white);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            z-index: 10;
        }

        /* SHARE MODAL */
        .share-modal {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: var(--white);
            border-radius: 16px;
            padding: 1rem;
            box-shadow: var(--shadow-lg);
            display: none;
            margin-bottom: 0.5rem;
            min-width: 200px;
        }

        .share-modal.active {
            display: block;
        }

        .share-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .share-option:hover {
            background: var(--light);
        }

        /* RESPONSIVE */
        @media (max-width: 992px) {
            .modal-body {
                grid-template-columns: 1fr;
            }

            .modal-gallery {
                border-right: none;
                border-bottom: 1px solid rgba(139, 69, 19, 0.08);
                padding: 2rem;
            }

            .product-swiper {
                height: 400px;
            }

            .modal-info {
                padding: 2rem;
            }

            .product-title {
                font-size: 2.2rem;
            }

            .product-price {
                font-size: 2.5rem;
            }

            .lang-switcher {
                top: 0.5rem;
                right: 0.5rem;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 0;
            }

            .modal-content {
                border-radius: 0;
                max-height: 100vh;
            }

            .modal-header {
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(10px);
            }

            .sticky-cta {
                display: block;
            }

            .product-title {
                font-size: 1.8rem;
            }

            .product-price {
                font-size: 2rem;
            }

            .artisan-profile {
                flex-direction: column;
                text-align: center;
            }

            .gallery-thumbs {
                gap: 0.5rem;
            }

            .gallery-thumb {
                width: 60px;
                height: 60px;
            }
        }

        /* LOADING SKELETON */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* ACCESSIBILITY */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* ERROR MESSAGE */
        .error-message {
            background: #ffe6e6;
            border: 2px solid var(--error);
            color: #a00;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            margin: 2rem;
        }

        [data-lang="en"] .lang-es {
            display: none !important;
        }

        [data-lang="es"] .lang-en {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Language Switcher -->
    <div class="lang-switcher">
        <button class="lang-btn active" data-lang="es" aria-label="Espa√±ol">ES</button>
        <button class="lang-btn" data-lang="en" aria-label="English">EN</button>
    </div>

    <!-- Demo Container -->
    <div class="demo-container">
        <h1 class="demo-title lang-es">Artesan√≠as Mexicanas Aut√©nticas</h1>
        <h1 class="demo-title lang-en">Authentic Mexican Crafts</h1>
        <p class="demo-subtitle lang-es">Descubre piezas √∫nicas hechas a mano por artesanos mexicanos</p>
        <p class="demo-subtitle lang-en">Discover unique handmade pieces by Mexican artisans</p>
        
        <button class="open-modal-btn" id="openModalBtn">
            <i class="fas fa-shopping-bag"></i>
            <span class="lang-es">Ver Producto Aleatorio</span>
            <span class="lang-en">View Random Product</span>
        </button>
        
        <p style="color: var(--gray); font-size: 0.9rem; margin-top: 1rem;">
            <i class="fas fa-info-circle"></i>
            <span class="lang-es">Cargando desde tu Google Sheets</span>
            <span class="lang-en">Loading from your Google Sheets</span>
        </p>
    </div>

    <!-- MODAL -->
    <div class="modal-overlay" id="modalOverlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <div class="modal-actions">
                    <button class="modal-action-btn wishlist-btn" id="wishlistBtn" aria-label="Add to wishlist">
                        <i class="far fa-heart"></i>
                    </button>
                    <div style="position: relative;">
                        <button class="modal-action-btn" id="shareBtn" aria-label="Share product">
                            <i class="fas fa-share-alt"></i>
                        </button>
                        <div class="share-modal" id="shareModal">
                            <div class="share-option" data-platform="whatsapp">
                                <i class="fab fa-whatsapp"></i> <span class="lang-es">WhatsApp</span><span class="lang-en">WhatsApp</span>
                            </div>
                            <div class="share-option" data-platform="facebook">
                                <i class="fab fa-facebook"></i> <span class="lang-es">Facebook</span><span class="lang-en">Facebook</span>
                            </div>
                            <div class="share-option" data-platform="twitter">
                                <i class="fab fa-twitter"></i> <span class="lang-es">Twitter</span><span class="lang-en">Twitter</span>
                            </div>
                            <div class="share-option" data-platform="copy">
                                <i class="fas fa-link"></i> <span class="lang-es">Copiar Link</span><span class="lang-en">Copy Link</span>
                            </div>
                        </div>
                    </div>
                    <button class="modal-action-btn" id="fullscreenBtn" aria-label="Fullscreen">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
                <button class="modal-close" id="modalClose" aria-label="Close modal">&times;</button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body" id="modalBody">
                <div style="padding: 3rem; text-align: center;">
                    <div class="skeleton" style="width: 100%; height: 400px; border-radius: 20px; margin-bottom: 1rem;"></div>
                    <div class="skeleton" style="width: 60%; height: 30px; margin: 0 auto 1rem;"></div>
                    <div class="skeleton" style="width: 40%; height: 20px; margin: 0 auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- LIGHTBOX -->
    <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Image viewer">
        <button class="lightbox-close" id="lightboxClose" aria-label="Close lightbox">&times;</button>
        <img id="lightboxImage" src="" alt="">
    </div>

    <!-- STICKY CTA (mobile) -->
    <div class="sticky-cta" id="stickyCta">
        <div class="sticky-cta-content">
            <div class="sticky-price" id="stickyPrice">--</div>
            <button class="cta-button" id="stickyCtaBtn">
                <i class="fab fa-whatsapp"></i>
                <span class="lang-es">Comprar</span>
                <span class="lang-en">Buy</span>
            </button>
        </div>
    </div>

    <!-- WISHLIST TOAST -->
    <div id="wishlistToast" style="position: fixed; top: 2rem; right: 2rem; background: var(--success); color: white; padding: 1rem 2rem; border-radius: 12px; box-shadow: var(--shadow-lg); display: none; z-index: 10001; transform: translateX(400px); transition: transform 0.3s;">
        <i class="fas fa-check-circle"></i>
        <span class="lang-es">¬°Agregado a favoritos!</span>
        <span class="lang-en">Added to wishlist!</span>
    </div>

    <script>
        // GLOBAL VARIABLES
        let currentProducto = null;
        let currentArtesano = null;
        let wishlistItems = JSON.parse(localStorage.getItem('wishlist') || '[]');
        let currentCurrency = 'MXN';
        let exchangeRates = { MXN: 1, USD: 0.055, EUR: 0.05 };

        // DOM ELEMENTS
        const openModalBtn = document.getElementById('openModalBtn');
        const modalOverlay = document.getElementById('modalOverlay');
        const modalBody = document.getElementById('modalBody');
        const modalClose = document.getElementById('modalClose');
        const wishlistBtn = document.getElementById('wishlistBtn');
        const shareBtn = document.getElementById('shareBtn');
        const shareModal = document.getElementById('shareModal');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const lightbox = document.getElementById('lightbox');
        const lightboxImage = document.getElementById('lightboxImage');
        const lightboxClose = document.getElementById('lightboxClose');
        const stickyCta = document.getElementById('stickyCta');
        const stickyPrice = document.getElementById('stickyPrice');
        const stickyCtaBtn = document.getElementById('stickyCtaBtn');
        const wishlistToast = document.getElementById('wishlistToast');

        // LANGUAGE SWITCHER
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const lang = btn.dataset.lang;
                document.documentElement.setAttribute('data-lang', lang);
                document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // API CONFIG
        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const API_BASE = isLocalhost ? 'http://localhost:3000/api' : 'https://patac-api.vercel.app/api';

        // UTILITY FUNCTIONS
        const esUrlValida = (url) => url && url.startsWith && (url.startsWith('http://') || url.startsWith('https://'));
        
        const formatCurrency = (amount, currency) => {
            const converted = amount * exchangeRates[currency];
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: currency
            }).format(converted);
        };

        const showToast = (message) => {
            wishlistToast.style.display = 'block';
            wishlistToast.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            wishlistToast.style.transform = 'translateX(0)';
            setTimeout(() => {
                wishlistToast.style.transform = 'translateX(400px)';
                setTimeout(() => wishlistToast.style.display = 'none', 300);
            }, 3000);
        };

        // MAIN FUNCTIONS
        async function cargarProductoAleatorio() {
            try {
                console.log('üîç Cargando productos desde la API...');
                
                const [productosRes, artesanosRes] = await Promise.all([
                    fetch(`${API_BASE}/productos`),
                    fetch(`${API_BASE}/artesanos`)
                ]);

                if (!productosRes.ok) throw new Error(`Error al cargar productos: ${productosRes.status}`);
                if (!artesanosRes.ok) throw new Error(`Error al cargar artesanos: ${artesanosRes.status}`);

                const productosData = await productosRes.json();
                const artesanosData = await artesanosRes.json();

                const productos = productosData.productos || [];
                const artesanos = artesanosData.artesanos || [];

                if (productos.length === 0) throw new Error('No hay productos disponibles');

                // Seleccionar producto aleatorio
                const randomIndex = Math.floor(Math.random() * productos.length);
                currentProducto = productos[randomIndex];
                
                // Buscar artesano por ID
                currentArtesano = artesanos.find(a => a.idArtesano == currentProducto.idArtesano);

                console.log('‚úÖ Producto cargado:', currentProducto);
                console.log('‚úÖ Artesano encontrado:', currentArtesano);

                // Update wishlist button state
                updateWishlistButton();
                
                renderModal();
            } catch (error) {
                console.error('‚ùå Error:', error);
                modalBody.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <h3 class="lang-es">Error al cargar el producto</h3>
                        <h3 class="lang-en">Error loading product</h3>
                        <p>${error.message}</p>
                        <p style="font-size: 0.85rem; margin-top: 0.5rem;">
                            Verifica que la API est√© funcionando en: ${API_BASE}
                        </p>
                    </div>
                `;
            }
        }

        function renderModal() {
            const producto = currentProducto;
            const artesano = currentArtesano;

            // Limpiar y validar im√°genes
            let galleryImages = [];
            if (producto.urlImagenesGaleria) {
                galleryImages = producto.urlImagenesGaleria.split(',')
                    .map(url => url.trim()).filter(esUrlValida);
            }
            
            if (galleryImages.length === 0 && esUrlValida(producto.urlImagenPrincipal)) {
                galleryImages = [producto.urlImagenPrincipal];
            }
            
            if (galleryImages.length === 0) {
                galleryImages = ['https://images.unsplash.com/photo-1565191999001-551c187427bb?w=800'];
            }

            const imagenArtesano = artesano && esUrlValida(artesano.urlFoto) 
                ? artesano.urlFoto 
                : 'https://images.unsplash.com/photo-1564564321837-a57b7070ac4f?w=200';

            const precioMXN = parseFloat(producto.precio);
            const whatsappMessage = encodeURIComponent(
                document.documentElement.getAttribute('data-lang') === 'es'
                    ? `¬°Hola! Me interesa este producto:\n\nüì¶ ${producto.nombre}\nüí∞ $${precioMXN.toLocaleString('es-MX')} MXN\nüë§ Artesano: ${artesano?.nombreCompleto || 'N/A'}\n\n¬øPodr√≠an darme m√°s informaci√≥n?`
                    : `Hello! I'm interested in this product:\n\nüì¶ ${producto.nombre}\nüí∞ $${precioMXN.toLocaleString('en-US')} MXN\nüë§ Artisan: ${artesano?.nombreCompleto || 'N/A'}\n\nCould you give me more information?`
            );

            // Update sticky CTA
            stickyPrice.innerHTML = formatCurrency(precioMXN, currentCurrency);

            modalBody.innerHTML = `
                <div class="modal-gallery">
                    <div class="gallery-container">
                        <div class="swiper product-swiper" id="productSwiper">
                            <div class="swiper-wrapper">
                                ${galleryImages.map((img, index) => `
                                    <div class="swiper-slide" data-lightbox="${img}" aria-label="Slide ${index + 1}">
                                        <img src="${img}" 
                                             alt="${producto.nombre}" 
                                             loading="lazy" 
                                             onerror="this.src='https://images.unsplash.com/photo-1565191999001-551c187427bb?w=800'">
                                        <div class="zoom-lens"></div>
                                        ${index === 0 && producto.videoProcesoUrl && esUrlValida(producto.videoProcesoUrl) ? `
                                            <div class="video-indicator">
                                                <i class="fas fa-play-circle"></i> 
                                                <span class="lang-es">Ver proceso</span>
                                                <span class="lang-en">Watch process</span>
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                            ${galleryImages.length > 1 ? `
                                <div class="swiper-button-next"></div>
                                <div class="swiper-button-prev"></div>
                                <div class="swiper-pagination"></div>
                            ` : ''}
                        </div>
                        <div class="gallery-thumbs" id="galleryThumbs">
                            ${galleryImages.slice(0, 4).map((img, index) => `
                                <div class="gallery-thumb ${index === 0 ? 'active' : ''}" data-slide="${index}">
                                    <img src="${img}" alt="Thumbnail ${index + 1}" loading="lazy">
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>

                <div class="modal-info">
                    <div class="product-meta">
                        <span class="meta-badge">SKU: ${producto.idProducto}</span>
                        <span class="meta-badge" data-lang="es">Categor√≠a: ${producto.categoria || 'Artesan√≠a'}</span>
                        <span class="meta-badge" data-lang="en">Category: ${producto.categoria || 'Crafts'}</span>
                        ${producto.stock > 0 ? `
                            <span class="meta-badge" style="color: var(--success);" data-lang="es">En stock</span>
                            <span class="meta-badge" style="color: var(--success);" data-lang="en">In stock</span>
                        ` : `
                            <span class="meta-badge" style="color: var(--error);" data-lang="es">Agotado</span>
                            <span class="meta-badge" style="color: var(--error);" data-lang="en">Out of stock</span>
                        `}
                    </div>

                    <span class="product-category">
                        <i class="fas fa-tag"></i> ${producto.categoria || 'Artesan√≠a'}
                    </span>
                    
                    <h1 class="product-title" id="modalTitle">${producto.nombre}</h1>
                    
                    <div class="product-price-section">
                        <div class="product-price" id="mainPrice">
                            ${formatCurrency(precioMXN, currentCurrency)}
                        </div>
                        <button class="price-converter" id="currencyBtn" aria-label="Change currency">
                            <i class="fas fa-exchange-alt"></i> ${currentCurrency}
                        </button>
                    </div>

                    <div class="product-badges">
                        <span class="badge badge-stock">
                            <i class="fas fa-check-circle"></i>
                            ${producto.stock > 0 ? `${producto.stock} <span class="lang-es">en stock</span><span class="lang-en">in stock</span>` : '<span class="lang-es">Agotado</span><span class="lang-en">Out of stock</span>'}
                        </span>
                        <span class="badge badge-impact">
                            <i class="fas fa-hand-holding-heart"></i>
                            ${producto.porcentajeArtesano || 70}% <span class="lang-es">para el artesano</span><span class="lang-en">to artisan</span>
                        </span>
                        <span class="badge badge-handmade">
                            <i class="fas fa-hands"></i>
                            <span class="lang-es">Hecho a mano</span>
                            <span class="lang-en">Handmade</span>
                        </span>
                        <span class="badge badge-certified">
                            <i class="fas fa-certificate"></i>
                            <span class="lang-es">Certificado</span>
                            <span class="lang-en">Certified</span>
                        </span>
                    </div>

                    <div class="trust-section">
                        <div class="trust-badges">
                            <div class="trust-badge">
                                <div class="trust-icon"><i class="fas fa-shipping-fast"></i></div>
                                <span class="lang-es">Env√≠o gratuito</span>
                                <span class="lang-en">Free shipping</span>
                            </div>
                            <div class="trust-badge">
                                <div class="trust-icon"><i class="fas fa-shield-alt"></i></div>
                                <span class="lang-es">Pago seguro</span>
                                <span class="lang-en">Secure payment</span>
                            </div>
                            <div class="trust-badge">
                                <div class="trust-icon"><i class="fas fa-undo"></i></div>
                                <span class="lang-es">Devoluciones</span>
                                <span class="lang-en">Returns</span>
                            </div>
                            <div class="trust-badge">
                                <div class="trust-icon"><i class="fas fa-leaf"></i></div>
                                <span class="lang-es">Sostenible</span>
                                <span class="lang-en">Sustainable</span>
                            </div>
                        </div>
                    </div>

                    <div class="product-description">
                        <h3><i class="fas fa-info-circle"></i> <span class="lang-es">Descripci√≥n</span><span class="lang-en">Description</span></h3>
                        <p>${producto.descripcion || '<span class="lang-es">Pieza artesanal √∫nica creada con t√©cnicas ancestrales y dedicaci√≥n.</span><span class="lang-en">Unique handmade piece created with ancestral techniques and dedication.</span>'}</p>
                    </div>

                    ${artesano ? `
                        <div class="artisan-card">
                            <h3><i class="fas fa-user-circle"></i> <span class="lang-es">Conoce al Artesano</span><span class="lang-en">Meet the Artisan</span></h3>
                            <div class="artisan-profile">
                                <img src="${imagenArtesano}" 
                                     alt="${artesano.nombreCompleto}" 
                                     class="artisan-avatar"
                                     loading="lazy"
                                     onerror="this.src='https://images.unsplash.com/photo-1564564321837-a57b7070ac4f?w=200'">
                                <div class="artisan-details">
                                    <h4>${artesano.nombreCompleto}</h4>
                                    <div class="artisan-location">
                                        <i class="fas fa-map-marker-alt"></i>
                                        ${artesano.comunidad || 'N/A'}, ${artesano.estado || 'N/A'}
                                    </div>
                                    <div class="artisan-technique">
                                        <i class="fas fa-paint-brush"></i>
                                        ${artesano.tecnica || '<span class="lang-es">T√©cnica ancestral</span><span class="lang-en">Ancestral technique</span>'}
                                    </div>
                                </div>
                            </div>
                            ${artesano.historia ? `
                                <div class="artisan-story">
                                    <p class="artisan-story-text">${artesano.historia}</p>
                                    <button class="show-more-btn lang-es">Ver m√°s</button>
                                    <button class="show-more-btn lang-en">Read more</button>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}

                    <a href="https://wa.me/525525213142?text=${whatsappMessage}" 
                       class="cta-button" 
                       id="mainCtaBtn"
                       target="_blank"
                       rel="noopener noreferrer">
                        <i class="fab fa-whatsapp"></i>
                        <span class="lang-es">Comprar por WhatsApp</span>
                        <span class="lang-en">Buy via WhatsApp</span>
                    </a>

                    <div class="impact-note">
                        <i class="fas fa-heart"></i>
                        <span class="lang-es">Con tu compra, <strong>${producto.porcentajeArtesano || 70}%</strong> va directamente al artesano</span>
                        <span class="lang-en"><strong>${producto.porcentajeArtesano || 70}%</strong> goes directly to the artisan</span>
                    </div>
                </div>
            `;

            // Initialize components
            initializeModalComponents();
        }

        function initializeModalComponents() {
            // Swiper
            const productSwiper = new Swiper('#productSwiper', {
                loop: document.querySelectorAll('.swiper-slide').length > 1,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                autoplay: {
                    delay: 5000,
                    disableOnInteraction: false,
                },
                on: {
                    slideChange: function(swiper) {
                        updateThumbs(swiper.realIndex);
                    }
                }
            });

            // Gallery thumbs
            document.querySelectorAll('.gallery-thumb').forEach((thumb, index) => {
                thumb.addEventListener('click', () => {
                    productSwiper.slideTo(index);
                });
            });

            // Lightbox
            document.querySelectorAll('[data-lightbox]').forEach(slide => {
                slide.addEventListener('click', function() {
                    if (!this.classList.contains('zoom-active')) {
                        const imgSrc = this.dataset.lightbox;
                        lightboxImage.src = imgSrc;
                        lightbox.classList.add('active');
                        document.body.style.overflow = 'hidden';
                    }
                });
            });

            lightboxClose.addEventListener('click', () => {
                lightbox.classList.remove('active');
                document.body.style.overflow = '';
            });

            lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox) {
                    lightbox.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });

            // Zoom on hover
            document.querySelectorAll('.swiper-slide').forEach(slide => {
                const img = slide.querySelector('img');
                slide.addEventListener('mousemove', (e) => {
                    if (slide.classList.contains('zoom-active')) {
                        const rect = slide.getBoundingClientRect();
                        const x = ((e.clientX - rect.left) / rect.width) * 100;
                        const y = ((e.clientY - rect.top) / rect.height) * 100;
                        img.style.transformOrigin = `${x}% ${y}%`;
                        img.style.transform = 'scale(2)';
                    }
                });
                
                slide.addEventListener('mouseleave', () => {
                    img.style.transform = 'scale(1)';
                });

                slide.addEventListener('click', (e) => {
                    if (!slide.classList.contains('zoom-active')) {
                        slide.classList.add('zoom-active');
                        e.stopPropagation();
                    } else {
                        slide.classList.remove('zoom-active');
                    }
                });
            });

            // Currency converter
            document.getElementById('currencyBtn').addEventListener('click', (e) => {
                e.preventDefault();
                const currencies = ['MXN', 'USD', 'EUR'];
                const currentIndex = currencies.indexOf(currentCurrency);
                currentCurrency = currencies[(currentIndex + 1) % currencies.length];
                
                const priceElement = document.getElementById('mainPrice');
                const currencyBtn = document.getElementById('currencyBtn');
                const stickyPriceElement = document.getElementById('stickyPrice');
                
                const newPrice = formatCurrency(parseFloat(currentProducto.precio), currentCurrency);
                priceElement.textContent = newPrice;
                stickyPriceElement.textContent = newPrice;
                currencyBtn.innerHTML = `<i class="fas fa-exchange-alt"></i> ${currentCurrency}`;
            });

            // Wishlist
            wishlistBtn.addEventListener('click', () => {
                const productId = currentProducto.idProducto;
                const isInWishlist = wishlistItems.includes(productId);
                
                if (isInWishlist) {
                    wishlistItems = wishlistItems.filter(id => id !== productId);
                    wishlistBtn.classList.remove('active');
                    wishlistBtn.innerHTML = '<i class="far fa-heart"></i>';
                    showToast(document.documentElement.getAttribute('data-lang') === 'es' ? 'Eliminado de favoritos' : 'Removed from wishlist');
                } else {
                    wishlistItems.push(productId);
                    wishlistBtn.classList.add('active');
                    wishlistBtn.innerHTML = '<i class="fas fa-heart"></i>';
                    showToast(document.documentElement.getAttribute('data-lang') === 'es' ? '¬°Agregado a favoritos!' : 'Added to wishlist!');
                }
                
                localStorage.setItem('wishlist', JSON.stringify(wishlistItems));
            });

            // Share modal
            shareBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                shareModal.classList.toggle('active');
            });

            document.addEventListener('click', () => {
                shareModal.classList.remove('active');
            });

            shareModal.addEventListener('click', (e) => {
                e.stopPropagation();
            });

            // Share options
            document.querySelectorAll('.share-option').forEach(option => {
                option.addEventListener('click', () => {
                    const platform = option.dataset.platform;
                    const url = window.location.href;
                    const text = `Check out this ${currentProducto.nombre} by ${currentArtesano?.nombreCompleto || 'artisan'}`;
                    
                    switch(platform) {
                        case 'whatsapp':
                            window.open(`https://wa.me/?text=${encodeURIComponent(`${text} ${url}`)}`, '_blank');
                            break;
                        case 'facebook':
                            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
                            break;
                        case 'twitter':
                            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
                            break;
                        case 'copy':
                            navigator.clipboard.writeText(url);
                            showToast(document.documentElement.getAttribute('data-lang') === 'es' ? '¬°Link copiado!' : 'Link copied!');
                            break;
                    }
                    shareModal.classList.remove('active');
                });
            });

            // Fullscreen
            fullscreenBtn.addEventListener('click', () => {
                modalOverlay.classList.toggle('fullscreen');
                const icon = fullscreenBtn.querySelector('i');
                icon.classList.toggle('fa-expand');
                icon.classList.toggle('fa-compress');
            });

            // Sticky CTA
            stickyCtaBtn.addEventListener('click', () => {
                document.getElementById('mainCtaBtn').click();
            });

            // Artisan story toggle
            const showMoreBtn = document.querySelector('.show-more-btn');
            if (showMoreBtn) {
                const storyText = document.querySelector('.artisan-story-text');
                if (storyText && storyText.textContent.length > 150) {
                    storyText.style.maxHeight = '60px';
                    storyText.style.overflow = 'hidden';
                    
                    showMoreBtn.addEventListener('click', () => {
                        if (storyText.style.maxHeight === '60px') {
                            storyText.style.maxHeight = 'none';
                            showMoreBtn.textContent = document.documentElement.getAttribute('data-lang') === 'es' ? 'Ver menos' : 'Read less';
                        } else {
                            storyText.style.maxHeight = '60px';
                            showMoreBtn.textContent = document.documentElement.getAttribute('data-lang') === 'es' ? 'Ver m√°s' : 'Read more';
                        }
                    });
                } else {
                    showMoreBtn.style.display = 'none';
                }
            }
        }

        function updateThumbs(activeIndex) {
            document.querySelectorAll('.gallery-thumb').forEach((thumb, index) => {
                thumb.classList.toggle('active', index === activeIndex);
            });
        }

        function updateWishlistButton() {
            if (!currentProducto) return;
            
            const isInWishlist = wishlistItems.includes(currentProducto.idProducto);
            if (isInWishlist) {
                wishlistBtn.classList.add('active');
                wishlistBtn.innerHTML = '<i class="fas fa-heart"></i>';
            } else {
                wishlistBtn.classList.remove('active');
                wishlistBtn.innerHTML = '<i class="far fa-heart"></i>';
            }
        }

        // EVENT LISTENERS
        openModalBtn.addEventListener('click', async () => {
            modalOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            stickyCta.style.display = 'block';
            await cargarProductoAleatorio();
        });

        modalClose.addEventListener('click', () => {
            modalOverlay.classList.remove('active');
            document.body.style.overflow = '';
            stickyCta.style.display = 'none';
            modalOverlay.classList.remove('fullscreen');
        });

        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
                modalOverlay.classList.remove('active');
                document.body.style.overflow = '';
                stickyCta.style.display = 'none';
                modalOverlay.classList.remove('fullscreen');
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (lightbox.classList.contains('active')) {
                    lightbox.classList.remove('active');
                    document.body.style.overflow = '';
                } else if (modalOverlay.classList.contains('active')) {
                    modalOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                    stickyCta.style.display = 'none';
                    modalOverlay.classList.remove('fullscreen');
                }
            }
        });

        // Close modal on ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modalOverlay.classList.contains('active')) {
                modalOverlay.classList.remove('active');
                document.body.style.overflow = '';
                stickyCta.style.display = 'none';
            }
        });
    </script>
</body>
</html>